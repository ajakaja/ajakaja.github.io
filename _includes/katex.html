<script>
const macros = {
        "\\d": "\\text{d}",
        "\\var": "\\delta",
        "\\D": "\\Delta",
        "\\p": "\\partial",
        "\\b": "\\mathbf",
        "\\bb": "\\mathbb",
        "\\tt": "\\texttt",
        "\\cal": "\\mathcal",
        "\\ola": "\\overleftarrow",
        "\\ora": "\\overrightarrow",
        "\\ra": "\\rightarrow",
        "\\lra": "\\leftrightarrow",
        "\\Ra": "\\Rightarrow",
        "\\Lra": "\\Leftrightarrow",
        "\\tr" : "\\text{tr}",
        "\\<": "\\langle",
        "\\>": "\\rangle",
        "\\e": "\\epsilon",
        "\\1": "\\mathbf{1}",
        "\\mrm": "\\mathrm",
        "\\del": "\\nabla",
        "\\such": "\\, \\vert \\,"};
function renderWithErrors(tex, displayMode) {
  try { 
    return katex.renderToString(tex, {
      displayMode: displayMode,
      throwOnError: false,
      macros: macros
    }); 
  } catch (e) {
    return "<span class='texerror'>" + e.message + "</span>";
  }
}
$("script[type='math/tex']").replaceWith(
  function(){
    var tex = $(this).text()
      .replace("% <![CDATA[", "")
      .replace("%]]>", "");
    return "<span class=\"inline-equation\">" + 
           renderWithErrors(tex, false) +
           "</span>";
});
$("script[type='math/tex; mode=display']").replaceWith(
  function(){
    var tex = $(this).text()
      .replace("% <![CDATA[", "")
      .replace("%]]>", "");
    return "<div class=\"equation\">" + 
           renderWithErrors(tex, true) +
           "</div>";
});</script>